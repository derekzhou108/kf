"use strict";var bindRoleValidateVm=avalon.define({$id:"bindRoleValidate",appId:util.getQueryString("appId"),app:{},appName:"",channelList:[],channelId:"",channelName:"",serverList:[],serverId:"",serverName:"",roleName:"",roleId:"",mobilePhone:"",verificationCode:"",role:"角色昵称",roleItems:["角色昵称","游戏ID"].map(function(e){return{val:e,text:e}}),step:0,cbSelect:function(e,i){var n=this;this[i]=e.value,"channelId"===i&&n.channelList.forEach(function(i){i.val===e.value&&(n.channelName=i.text)}),"serverId"===i&&n.serverList.forEach(function(i){i.val===e.value&&(n.serverName=i.text)})},goStep1:function(){var e=this,i={appId:e.appId,sdkUserId:util.getStorage("userInfo").user_id,channelId:this.channelId,serverId:this.serverId,roleId:$.trim(this.roleId),roleName:$.trim(this.roleName),mobilePhone:$.trim(this.mobilePhone)};return i.roleId||i.roleName?util.isPhone(i.mobilePhone)?void api.sendVerification(i).then(function(i){e.step=1}):(dialog.errorMsg("请输入正确手机号码"),!1):(dialog.errorMsg("请输入角色昵称或者角色ID"),!1)},goStep0:function(){this.step=0},roleBind:function(){var e=util.getStorage("userInfo"),i={appId:this.appId,sdkUserId:e.user_id,channelId:this.channelId,serverId:this.serverId,roleId:this.roleId,roleName:this.roleName,mobilePhone:this.mobilePhone,verificationCode:$.trim(this.verificationCode)};if(!i.verificationCode)return dialog.errorMsg("请输入验证码"),!1;api.validateRoleBind(i).then(function(e){dialog.confirm("绑定成功",function(){window.location.href="/pc/bind-role-done"},function(){window.location.href="/pc/bind-role-done"})})}});bindRoleValidateVm.$watch("onReady",function(){var e=this;api.serverList({appId:e.appId}).then(function(i){e.app=i.data.app,e.appName=i.data.app.appname,e.channelList=i.data.channelList.map(function(e){return{val:e.channelNo,text:e.channelName}}),e.serverList=i.data.serverList.map(function(e){return{val:e.id,text:e.serverName}})}),bindRoleValidateVm.$watch("role",function(){this.roleName="",this.roleId=""})});