"use strict";var issueVm=avalon.define({$id:"issue",type:parseInt(util.getQueryString("type"),10),serverList:[],uploadList:[],problemType:["闪退","卡机","掉线","无法登录","无法连接","黑屏","更新失败","找不到服务器","其他"].map(function(e){return{val:e,text:e}}),problemType2:["举报问题","申诉问题"].map(function(e){return{val:e,text:e}}),systemType:["IOS","安卓","其他"].map(function(e){return{val:e,text:e}}),netOperator:["移动","联通","电信","铁通","教育网","网通","宽带","其他"].map(function(e){return{val:e,text:e}}),netType:["2G","3G","4G","wifi","其他"].map(function(e){return{val:e,text:e}}),reportType:["举报外挂","举报工作室","发布虚假消息","发布黄色内容","发布政治言论","辱骂他人","欺诈行为","举报头像","涉嫌赌博","昵称违规","宣传代练","宣传线下交易","宣传代充","其他"].map(function(e){return{val:e,text:e}}),appealType:["帐号封停","角色禁言","其他"].map(function(e){return{val:e,text:e}}),issue0:{appId:util.getStorage("role").appId,qType:parseInt(util.getQueryString("type"),10)+1,channelId:util.getStorage("role")&&util.getStorage("role").channelId||"",serverName:util.getStorage("role")&&util.getStorage("role").serverName||"",roleName:util.getStorage("role")&&util.getStorage("role").roleName||"",roleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitRoleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitServerId:util.getStorage("role")&&util.getStorage("role").serverId||"",phone:"",money:"",time:"",desc:""},issue1:{appId:util.getStorage("role").appId,qType:parseInt(util.getQueryString("type"),10)+1,channelId:util.getStorage("role")&&util.getStorage("role").channelId||"",serverName:util.getStorage("role")&&util.getStorage("role").serverName||"",roleName:util.getStorage("role")&&util.getStorage("role").roleName||"",roleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitRoleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitServerId:util.getStorage("role")&&util.getStorage("role").serverId||"",phone:"",desc:""},issue2:{appId:util.getStorage("role").appId,qType:parseInt(util.getQueryString("type"),10)+1,channelId:util.getStorage("role")&&util.getStorage("role").channelId||"",serverName:util.getStorage("role")&&util.getStorage("role").serverName||"",roleName:util.getStorage("role")&&util.getStorage("role").roleName||"",roleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitRoleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitServerId:util.getStorage("role")&&util.getStorage("role").serverId||"",phone:"",desc:""},issue3:{appId:util.getStorage("role").appId,qType:parseInt(util.getQueryString("type"),10)+1,problemType:"",systemType:"",netOperator:"",netType:"",time:"",briefDesc:"",phoneType:"",systemVersion:"",city:"",channelId:util.getStorage("role")&&util.getStorage("role").channelId||"",serverName:util.getStorage("role")&&util.getStorage("role").serverName||"",roleName:util.getStorage("role")&&util.getStorage("role").roleName||"",roleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitRoleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitServerId:util.getStorage("role")&&util.getStorage("role").serverId||"",phone:"",desc:""},issue4:{appId:util.getStorage("role").appId,qType:parseInt(util.getQueryString("type"),10)+1,problemType:"举报问题",reportType:"",complainType:"",time:"",channelId:util.getStorage("role")&&util.getStorage("role").channelId||"",serverName:util.getStorage("role")&&util.getStorage("role").serverName||"",roleName:util.getStorage("role")&&util.getStorage("role").roleName||"",roleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitRoleId:util.getStorage("role")&&util.getStorage("role").roleId||"",submitServerId:util.getStorage("role")&&util.getStorage("role").serverId||"",reportedRoleName:"",reportedRoleId:"",phone:"",desc:""},issue0err:{serverName:!1,roleName:!1,money:!1,time:!1,phone:!1,desc:!1,images:!1},issue1err:{serverName:!1,roleName:!1,phone:!1,desc:!1},issue2err:{serverName:!1,roleName:!1,phone:!1,desc:!1},issue3err:{serverName:!1,roleName:!1,phone:!1,desc:!1},issue4err:{serverName:!1,roleName:!1,phone:!1,desc:!1},cbSelect:function(e,t){var r=t.split(".");this[r[0]][r[1]]=e.value,this[r[0]+"err"][r[1]]=!1},changeType:function(){this.issue4.reportType="",this.issue4.complainType="",this.issue4.time="",this.issue4.reportedRoleName="",this.issue4.reportedRoleId=""},uploadDel:function(e){var t=this;dialog.confirm("确认删除吗？",function(){t.uploadList.forEach(function(t,r,o){t.imageUrl===e.imageUrl&&o.splice(r,1)})})},openPhotos:function(e){var t=this.uploadList.map(function(e){return{alt:"",pid:0,src:e.imageUrl,thumb:e.imageUrl}}),r={title:"",id:this.$id,start:e,data:t};layer.photos({photos:r,anim:5})},submit:function(){var e=this,t=this.type,r=this["issue"+t].$model;r.images=this.uploadList.toJSON(),r.sdkUserId=util.getStorage("userInfo").user_id,r.time&&(r.time=new Date(r.time.replace(/\-/g,"/")).getTime()/1e3),void 0!==r.serverName&&""===$.trim(r.serverName)&&(this["issue"+t+"err"].serverName=!0),void 0!==r.roleName&&""===$.trim(r.roleName)&&(this["issue"+t+"err"].roleName=!0),void 0!==r.money&&""===$.trim(r.money)&&0===t&&(this["issue"+t+"err"].money=!0),void 0!==r.time&&""===$.trim(r.time)&&0===t&&(this["issue"+t+"err"].time=!0),$.trim(r.phone)&&!util.isPhone($.trim(r.phone))&&(this["issue"+t+"err"].phone=!0),$.trim(r.desc).length<6&&(this["issue"+t+"err"].desc=!0),r.images.length||0!==t||(this["issue"+t+"err"].images=!0);var o=this["issue"+t+"err"].$model;for(var i in o)if(o[i])return!1;switch(t){case 0:api.postRecharge(r).then(function(t){1e4===t.code?e.submitSuccess():dialog.errorMsg(t.msg)});break;case 1:api.postBug(r).then(function(t){1e4===t.code?e.submitSuccess():dialog.errorMsg(t.msg)});break;case 2:api.postSuggest(r).then(function(t){1e4===t.code?e.submitSuccess():dialog.errorMsg(t.msg)});break;case 3:api.postNetwork(r).then(function(t){1e4===t.code?e.submitSuccess():dialog.errorMsg(t.msg)});break;case 4:api.postReport(r).then(function(t){1e4===t.code?e.submitSuccess():dialog.errorMsg(t.msg)})}},submitSuccess:function(){dialog.successMsg("提交成功，请等候GM消息！"),setTimeout(function(){window.location.href="/pc/issue-table"},2e3)}});issueVm.$watch("onReady",function(){var e=this,t=util.getStorage("role").appId;api.serverList({appId:t}).then(function(t){e.serverList=t.data.serverList.map(function(e){return{val:e.serverName,text:e.serverName}})}),issueVm.$watch("issue4.problemType",function(){this.changeType()}),issueVm.$watch("upload",function(e){this.uploadList.push(e)}),issueVm.$watch("uploadList",function(e){e.length&&(this.issue0err.images=!1)})});